!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlovaAdapterXhr={})}(this,(function(e){"use strict";const t=!0,o=()=>{},s=(e,t)=>e instanceof t,r=e=>new Error(e),n=e=>{const t={};if(""===e)return t;return e.trim().split(/[\r\n]+/).forEach((e=>{const[o,s]=e.split(/:\s*/);t[o]=s})),t},a=e=>"string"==typeof e||(e=>{const t=Object.prototype.toString.call(e);return/^\[object (Blob|FormData|ReadableStream)\]$/i.test(t)||s(e,ArrayBuffer)||s(e,URLSearchParams)})(e);e.xhrMockResponse=({status:e,statusText:t,body:o,responseHeaders:s})=>({response:{data:o,status:e,statusText:t,headers:s},headers:s}),e.xhrRequestAdapter=function(){return({type:e,url:s,data:l=null,headers:i},d)=>{const{config:u}=d,{auth:p,withCredentials:c,mimeType:f}=u;let h,y=o,b=o;const m=new Promise(((o,d)=>{try{h=new XMLHttpRequest,h.open(e,s,t,null==p?void 0:p.username,null==p?void 0:p.password),h.responseType=u.responseType||"json",h.timeout=u.timeout||0,c===t&&(h.withCredentials=c),f&&h.overrideMimeType(f);let j=false,T=false;Object.keys(i).forEach((e=>{/content-type/i.test(e)&&(j=t,T=/application\/x-www-form-urlencoded/i.test(i[e])),h.setRequestHeader(e,i[e])})),j||l&&"[object FormData]"===l.toString()||h.setRequestHeader("Content-Type","application/json; charset=UTF-8"),u.enableDownload&&(h.onprogress=e=>{y(e.loaded,e.total)}),u.enableUpload&&(h.upload.onprogress=e=>{b(e.loaded,e.total)}),h.onload=()=>{o({status:h.status,statusText:h.statusText,data:h.response,headers:n(h.getAllResponseHeaders())})},h.onerror=()=>{d(r("Network Error"))},h.ontimeout=()=>{d(r("Network Timeout"))},h.onabort=()=>{d(r("The user aborted a request"))};let g=l;T&&(m=g,"[object Object]"===Object.prototype.toString.call(m)&&null!==m)&&(g=(e=>{const t=[];let o=[],s=0,r=0;return JSON.stringify(e,((e,n)=>{if(""!==e)if("object"==typeof n&&null!==n)o.push(e),r+=Object.keys(n).length;else if(void 0!==n){const a=[...o,e].map(((e,t)=>t>0?`[${e}]`:e)).join("");t.push(`${a}=${n}`),s>=r-1?(o=[],s=r=0):s++}return n})),t.join("&")})(g)),null!==g&&(g=a(g)?g:JSON.stringify(g)),h.send(g)}catch(e){d(e)}var m}));return{response:()=>m,headers:()=>m.then((e=>e.headers)),abort:()=>{h.abort()},onDownload:e=>{y=e},onUpload:e=>{b=e}}}},Object.defineProperty(e,"__esModule",{value:!0})}));
